Analysis of Relationship Between Player Injuries and NFL Combine Results and Other Statistics, 2009-2016
by Seth Farnsworth
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code
# chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(gridExtra)
library(dplyr)
library(GGally)
library(reshape2)
library(knitr)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
setwd("C:/users/farnsfam/Documents/udacity data science/Data Analyst Nanodegree/Exploratory Data Analysis with R/final_project")
stats <- read.csv('football_data_(stats).csv')
combine <- read.csv('football_data_(combine).csv')
injuries <- read.csv('football_data_(injuries).csv')
```

This is data I gleaned from multiple sources with contains information on NFL players, to include their NFL combine measurements (height, weight, speed, etc.), ages, various performance statistics, and games missed due to injury per season of their career. My main interest here is in looking at potential correlations between injury rates and the other aforementioned variables. As an avid NFL fan, I know that injuries play a vital and unpredictable role in the success of each NFL franchise each season. So I thought it would be fun to look at some different variables that might have a role in player injury rates, and see if anything interesting jumps out as we explore the data.

There are three datasets I'm using for this--one with injury data for each player per season from 2009-2016; one for NFL combine measurements for players from 1999-2015; and another with NFL statistics including birthdates, career performance statistics (passing yards, receptions, rushing average, etc.) and draft data (round, position).

As this data did not exists as a unified, clean dataset prior to this project, I had to do a fair bit of work to gather and clean the data prior to performing this exploratory analysis in R. For details on that process, you can see my write-up on that [here](https://github.com/sethfarns/udacity-data-analyst-nanodegree/blob/master/exploratory-data-analysis-with-r/Wrangle%2BFootball%2BStatistics%2BData.html).

# Univariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots1}
str(combine)
str(injuries)
str(stats)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots2}
summary(combine)
summary(injuries)
summary(stats)
```
Our injuries data set contains 5,936 observations of 8 variables. The combine data set contains 1,295 observations of 18 variables, and the stats dataset contains 1,981 observations of 33 variables. There are more observations for the injury dataset because it contains injury data for each season of the players' careers, while the other two datasets cover their entire careers. The injury data needed to be seasonal in order to measure the effect of age on injury rates season-by-season. These are all relationable tables, with 'Player' and 'Pos' the common keys between the three tables. The 'Pos' field is the primary factor variable we'll be exploring with these three datasets. There is also a 'position_group' factor, which is just a condensing of the position variable (from 23 options down to 10).

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots3}
plot1 = ggplot(aes(Total_Injured), data=injuries) +
  geom_histogram(bins=16, color='red', fill='gray') +
  xlab('Games Missed by Injury (16-game season)')

plot2 = ggplot(aes(injured_pct), data=combine) +
  geom_histogram(bins=50, color='red', fill='gray') +
  xlab('Career Injury Rate')

grid.arrange(plot1, plot2)
```

The vast majority of players suffered no injuries each season, resulting in a mostly skewed-right long tail histogram. It is noteworthy, however, that there's a significant spike at 16 games, for players who missed the entire season due to injury. I would imagine this is probably due to players injured before the season begins being placed on injured reserve, and not being able to return due to NFL rules, even if they might be healthy enough to play late in the season.

The histogram for career injury rate is similarly skewed right, though in this case we had more players with a low injury rate (~0.1 or 10%). Once again, there's a jump at the far right of the graph for players with a 100% injury rate. My guess would be this is skewed by players who only played in one season and missed the whole season due to injury.

Let's take a look at player age in another histogram.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots4}
ggplot(aes(age), data=injuries) +
  geom_histogram(bins=16, color='red', fill='gray') +
  xlab('Age at Start of NFL Season')
```

This one's almost a normal distribution, with most players in their mid-twenties, and the numbers tapering off in each direction down to the early twenties and the early thirties. There is one little spike around age 30, but I'm not sure if that's statistically significant. Let's look at the same data on a log10 scale.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots5}
ggplot(aes(age), data=injuries) +
  geom_histogram(bins=16, color='red', fill='gray') +
  scale_x_log10() +
  xlab('Age at Start of NFL Season (log10)')
```

With the log10 transformation, it looks like more of a normal distribution, and the spike around 30 is all but gone.

Now let's look at distributions of players by the categorical 'position' variable.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots6}
ggplot(aes(Pos), data=combine) +
  geom_histogram(stat='count', color='red', fill='gray') +
  xlab('Position')
```

Lots of wide receivers and running backs (teams typically carry 3-6 of each), not so many kickers and punters (each team carries just 1). So there's nothing surprising here. Now let's look at the measurables height, weight, arm length, and hand size.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots7}
plot1 = ggplot(aes(heightinchestotal), data=combine) +
  geom_histogram(binwidth=1, color='red', fill='gray') +
  xlab('Height (in inches)')

plot2 = ggplot(aes(weight), data=combine) +
  geom_histogram(binwidth=5, color='red', fill='gray') +
  xlab('Weight (in pounds)')

plot3 = ggplot(aes(arms), data=subset(combine, arms != 0)) +
  geom_histogram(binwidth=0.2, color='red', fill='gray') +
  xlab('Arm Length (inches)')

plot4 = ggplot(aes(hands), data=subset(combine, hands != 0)) +
  geom_histogram(binwidth=0.2, color='red', fill='gray') +
  xlab('Hand Size (inches)')

grid.arrange(plot1, plot2, plot3, plot4, ncol=2)
```

Heights range from 5'6" (66 in.) to 6'8" (80 in.). Its distribution is mostly unimodal, with the peak occurring between 6'3" and 6'6" (73-76 inches).

For weight, the range is between 164 and 349 lbs. The distribution is a little more interesting than for height, however, with peaks apparently occuring around 200, 220, 260, and slightly over 300 pounds. I suspect we'll learn more about this when we do the bivariate analysis and look at how position affects player weight. It would also be interesting to see how it changes with age, but unfortunately we won't be able to do that here--official NFL player data on weight is not updated throughout the player's career.

Arm length and hand size appear to be mostly normal distributions. It is worth noting that these two measurements were not available for all players, as is also the case with most of the combine drills that we'll look at next.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots8}
plot1 = ggplot(aes(bench), data=subset(combine, bench != 0)) +
  geom_histogram(binwidth=1, color='red', fill='gray') +
  xlab('Bench Press Reps (225 lbs each)')

plot2 = ggplot(aes(broad), data=subset(combine, broad != 0)) +
  geom_histogram(binwidth=1, color='red', fill='gray') +
  xlab('Broad Jump (inches)')

plot3 = ggplot(aes(vertical), data=subset(combine, vertical != 0)) +
  geom_histogram(binwidth=0.5, color='red', fill='gray') +
  xlab('Vertical Jump (inches)')

grid.arrange(plot1, plot2, plot3)

```

Our first three plots of the combine fitness test results--bench press, broad jump, and vertical jump--all show relatively normal distributions. There are some significant outliers on these, especially on the lower end of the broad jump.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots9}
plot1 = ggplot(aes(tenyd), data=subset(combine, tenyd != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('10 Yard Dash (seconds)')

plot2 = ggplot(aes(twentyyd), data=subset(combine, twentyyd != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('20 Yard Dash (seconds)')

plot3 = ggplot(aes(fortyyd), data=subset(combine, fortyyd != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('40 Yard Dash (seconds)')

grid.arrange(plot1, plot2, plot3)
```

Here we have the three straight-line speed tests--the 10-yard, 20-yard, and 40-yard dashes. The 40-yard dash is by far the most well known, and it's also the one that players train the most for prior to the combine, which probably explains why there's so much more data for that test than for the others.

The 40-yard dash data is clearly skewed right. The 10-yard and 20-yard dashes are also skewed right, though it's harder to see, likely because of the lack of data relative to the 40-yard dash totals.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots10}
plot1 = ggplot(aes(fortyyd), data=subset(combine, fortyyd != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('40 Yard Dash (seconds)')

plot2 = ggplot(aes(fortyyd), data=subset(combine, fortyyd != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('40 Yard Dash (seconds) (log10)') +
  scale_x_log10()

plot3 = ggplot(aes(fortyyd), data=subset(combine, fortyyd != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('40 Yard Dash (seconds) (square root)') +
  scale_x_log10()

grid.arrange(plot1, plot2, plot3)
```

When looking at the 40-yard dash distribution next to its log10 and square root transformations, you can see how smooth the distribution is with the transformations.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots11}
plot1 = ggplot(aes(twentyss), data=subset(combine, twentyss != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('20 Yard Short Shuttle (seconds)')

plot2 = ggplot(aes(threecone), data=subset(combine, threecone != 0)) +
  geom_histogram(binwidth=0.01, color='red', fill='gray') +
  xlab('3 Cone Drill (seconds)') +
  scale_x_log10()

grid.arrange(plot1, plot2)
```

These last two tests, the 20-yard short shuttle and the 3-cone drill, measure agility and change of direction ability. These mostly look like unimodal normal distributions, with maybe a slight skew to the right, although with the short shuttle there are some other peaks in there, notably at 4.0, 4.4, and around 4.75 seconds. Now let's look at some NFL player statistics.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots12}
ggplot(aes(Yds), 
       data=subset(stats, (Pos == 'QB' & Yds > 0))) +
  geom_histogram(binwidth=500, color='red', fill='gray') +
  xlab('Career Passing Yards') +
  scale_x_continuous(breaks=seq(0,40000,1000)) +
  xlim(0,40000)
```

Here we can see career passing yards. I had to cut off the data at 40,000 yards, since it made it difficult to see most of the data, which is under 5,000 yards. Another clearly skewed-right distribution with this statistic. Let's look at the same thing for rushing yards.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots13}
ggplot(aes(Yds), data=subset(stats, Pos == 'RB' & Yds > 0)) +
  geom_histogram(binwidth=500, color='red', fill='gray') +
  xlab('Career Rushing Yards') +
  scale_x_continuous(breaks=seq(0, 15000, 1000))
```

Again, another skewed-right long-tail distribution. We do have a much bigger sample size here than with the passing yards, which makes sense, as there are a lot more NFL players who rush the ball than throw it, especially when you consider that most quarterbacks would also register on this statistic. But I think to get a better view of these career statistics, it will be more useful to try and average these over each season of a player's career.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots14}
stats$seasons_played <- stats$End_Year - stats$Start_Year + 1

plot1 = ggplot(aes((Yds / seasons_played)), 
       data=subset(stats, Pos == 'QB' & Yds > 0)) +
  geom_histogram(binwidth=100, color='red', fill='gray') +
  xlab('Average Passing Yards per Season') +
  scale_x_continuous(breaks=seq(0,4500,500))

plot2 = ggplot(aes((Yds / seasons_played)), 
       data=subset(stats, Pos == 'RB' & Yds > 0)) +
  geom_histogram(binwidth=50, color='red', fill='gray') +
  xlab('Average Rushing Yards per Season') +
  scale_x_continuous(breaks=seq(0,1500,100))

grid.arrange(plot1, plot2)
```

The plot for average passing yards is mostly skewed-right, but there is also a slight uptick after about 3,000 yards. Average rushing yards is a smoother distribution, probably in part because there's a much larger sample size.

Let's do one more plot to look at draft position

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots15}
ggplot(aes(Draft_Pick), 
       data=subset(stats, Draft_Pick == Draft_Pick)) +
  geom_histogram(color='red', fill='gray') +
  xlab('Draft Position') +
  scale_x_continuous(breaks=seq(0, 250, 25))
```

Again, another long-tail, skewed-right distribution. It's interesting that while one player is picked at each position in the draft each year, this plot shows there are far more early picks in the NFL than late picks. Multiple factors could explain this, including just the general talent level of early draft picks versus later ones.

# Univariate Analysis

### What is the structure of your dataset?

We have thousands of players in three different datasets, comprising injury data per season, NFL combine data, birth dates, draft data, and various career statistics. For our combine measurements, the plots are primarily normal distributions, while for player statistics, injuries, and draft position, we're looking at mainly skewed-right long-tail histograms.

Other observations:

* While in most seasons, most players did not miss any games due to injury, there was also a significant jump in players missing the entire season.
* Player age is very much a skewed right distribution, with most players being in their early twenties when each NFL season begins. As many NFL players are known to say, in the NFL it really is "Not For Long".
* While most of the combine measurements are unimodal, some--such as weight--have several peaks. It will be interesting to see how position, age, and other factors correlate to these measurements.
* Draft position appears to have a good correlation to how long players stay in the league, as there are more early draft picks in the league than later ones. It will be cool to look at how other variables correlate with draft position, such as combine measurement and player performance metrics.

### What is/are the main feature(s) of interest in your dataset?

The primary feature of interest to me in this dataset is the number of games missed due to injury by each player in each season. While there are other observations to be made on this data, and as this is an exploratory data analysis I don't want to miss anything by being too heavily biased toward one thing, but injuries are such a huge and seemingly unpredictable part of the NFL. If we could find some correlation between age or any of the combine measurements and a player's injury rate, that would be really interesting, in my opinion.

### What other features in the dataset do you think will help support your \
investigation into your feature(s) of interest?

The age at the beginning of each NFL season and the various combine measurements will all be helpful for my investigation of player injury rates. I would actually be shocked if age didn't have some correation to injury rates. I also think things like height and weight will have some correlation, but it will probably vary by position. At least that would be my guess. I'll also look a bit at how injury rates affect players' performance and longevity.

### Did you create any new variables from existing variables in the dataset?

Yes, I had to create player age at the beginning of each season, by subtracting the year of the player's birth from the current season. This was done in order to measure the effect of age on games missed due to injury. I also created position_group from the Position variable, in order to condense the number of factors to better players by position group (this will be done later). Another variable I created for the univariate analysis specifically was average yards per season for both passing yards and rushing yards.

### Of the features you investigated, were there any unusual distributions? \
Did you perform any operations on the data to tidy, adjust, or change the form \
of the data? If so, why did you do this?

Yes, I had to do a lot of this, as the data came from three different sources (several different CSV files from two different websites, with the rest scraped from [Pro Football Reference](https://www.pro-football-reference.com/)). Full details on this are available in my separate report you can view on GitHub, but the data from the different datasets had to be changed so they would correlate with each other. For example, in the data from Pro Football Reference, many players were listed with multiple positions, while the injury and combine data only listed one position for each player. In order to get the data to correlate across the data sets, I had to flatten out the PFR data, by making one record for each position listed for each player, then joining it with the other data sets on player and position.

# Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots1}
ggplot(aes(x = age, y = Total_Injured), data=injuries) +
  geom_jitter(alpha=0.2) +
  xlab("Player Age at Start of Season") +
  ylab("Injured Games per Season") +
  geom_line(stat='summary', fun.y=mean, aes(color="Mean")) +
  geom_smooth(method='lm', aes(color="Regression"))
```

Somewhat surprisingly, there is clearly very little correlation between player age at the beginning of the season and games missed due to injury. There are a lot of factors that could be at play here--when an older player gets hurt, often he won't be signed by any team and basically 'retires' at that point. Those cases won't show in the data. Also, injuries occur for a variety of reasons, many being freak accidents that wouldn't correlate to age. To see a true correlation, we would need data for injured players who get released or don't get signed by any teams due to injury, as well as categories of injuries. Let's look next at the various combine measurements and see what correlations exist between them.

It is worth noting, however, that when looking at the mean line, you can see that there is noticeable increase with players from around 32 to 35 years of age and. Let's look at a subset of that data to see if there is a stronger correlation.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots2}
over_thirty <- subset(injuries, age > 30)

ggplot(aes(x = age, y = Total_Injured),
       data=over_thirty) +
  geom_jitter(alpha=0.2) +
  xlab("Player Age at Start of Season (>30)") +
  ylab("Injured Games per Season") +
  geom_line(aes(color='Mean'), stat='summary', fun.y=mean) +
  geom_smooth(method='lm', aes(color='Regression'))

cor(injuries$age, injuries$Total_Injured)
cor(over_thirty$age, over_thirty$Total_Injured)
```

Here you can see a slightly greater correlation (0.03 vs. -0.01 for all the data), but the difference is very slight.

Can we find correlations between injury rates and others of our variables? Let's look at a few of them now.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots3}
plot1 = ggplot(aes(x = weight, y = injured_pct),
               data=combine) +
  geom_jitter(alpha=0.2) +
  xlab("Player Weight") +
  ylab("Injured Percentage") +
  geom_line(stat='summary', fun.y=mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression'))

plot2 = ggplot(aes(x = heightinchestotal, y = injured_pct),
               data=combine) +
  geom_jitter(alpha=0.2) +
  xlab("Player Height") +
  ylab("Injured Percentage") +
  geom_line(stat='summary', fun.y=mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression'))

grid.arrange(plot1, plot2)
```

Clearly not much correlation for these, but I wonder what it would look like to compute density as weight divided by height, and see how that correlates to other variables.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots4}
combine$density = combine$weight / combine$heightinchestotal

ggplot(aes(x = density, y = injured_pct), data=combine) +
  geom_jitter(alpha=0.2) +
  xlab("Player Density") +
  ylab("Injured Percentage") +
  geom_line(stat='summary', fun.y=mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression'))
```

Okay, so even when using a composite statistic for weight and height, we're not going to be able to correlate this to percentage of games missed over player's career. Possibly a dead end, but we'll see what these look like later when we break them down by position. Let's switch gears a bit and take a more generic look at correlations between our various features and see what we can find. We'll start with the combine measurements.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots5}
combine_subset <- combine[, c(2,3,4,5,6,8,9,10,11,12,17,19)]
cor(combine_subset)
ggpairs(combine_subset, cardinality_threshold=15)
```

The strongest correlations are between arms and hand size (0.995) and broad and vertical jump (0.79). There were also lesser correlations between 10-yd and 20-yd dash (0.565), broad jump and 20-yd short shuttle (0.556), and vertical jump and 20-yd short shuttle (0.545). Most of these were to be expected, as the measurements were similar (for example arms and hand size), but I did find the correlation between the jumping measurements and the short shuttle to be interesting. It's not a super strong correlation, but maybe worth looking into a little closer.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots6}
ggplot(aes(x = twentyss, y = broad),
       data=subset(combine, broad != 0 & twentyss != 0)) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  ylab("Broad Jump") +
  xlab("20-yard Short Shuttle")
```

Just looking at the scatter plot, it's a little hard to see much correlation, but it's much clearer with the mean and regression lines. The correlation appears to be negative, but remember that lower times in the short shuttle are actually better, so someone better (lower time) at the short shuttle generally seems to also be better (higher in inches) at the broad jump. Now let's look at two pairs of variables that are more closely correlated.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots7}
p1 = ggplot(aes(x = heightinchestotal, y = weight),
       data=subset(combine, heightinchestotal != 0 & weight != 0)) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  xlab("Height") +
  ylab("Weight")

p2 = ggplot(aes(x = hands, y = arms),
       data=subset(combine, hands != 0 & arms != 0)) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  xlab("Hand Size") +
  ylab("Arm Size")

grid.arrange(p1, p2, ncol=1)

```

Both of these are very strong positive correlations, which you can see really clearly with the scatter plot but also with the mean and regression lines. These make sense too--you would logically assume someone with bigger hands to also have bigger arms, and taller people tend to be heavier as well.

Now lets look at how a player's position is related to these other measurements, starting with injured percentage.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots8}
ggplot(aes(x = Pos, y = injured_pct),
       data=subset(combine)) +
  geom_boxplot() + 
  xlab("Position") +
  ylab("Injured Percentage")
```

As we can see from the above box plot, a player's position can have a pretty big effect on a player's injured percentage (percentage of games lost due to injury) throughout his career. Kickers and punters have by far the lowest injury rate, which makes sense, since they are not every-down players, and they rarely even get hit in games. Center appears to be the highest, with a median injured rate of 0.25. Free safety, inside linebacker, and wide receiver had the lowest rates after kicker and punter, all hovering around 0.125. Now let's look at density by position.


```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots9}
ggplot(aes(x = Pos, y = density),
       data=subset(combine)) +
  geom_boxplot() + 
  xlab("Position") +
  ylab("Density")
```

This one appears to be all over the place. Center, defensive tackle, offensive guard, and offensive tackle all are quite dense (higher density score), while kicker, cornerback, and wide receivers are all generally quite lean (lower density score).

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots10}
ggplot(aes(x = Pos, y = fortyyd),
       data=subset(subset(combine, fortyyd != 0))) +
  geom_boxplot() + 
  xlab("Position") +
  ylab("Forty Yard Dash Time")
```

Here we again have definite groupings. Wide receivers and cornerbacks have the fastest times (possibly correlated to their leaner body types--we'll look at that in the next section), while offensive guards and tackles have the slowest 40 times.

Now let's look at some player statistic correlations, starting with [AV (approximate value)](https://www.pro-football-reference.com/blog/index37a8.html), a custom statistic from Pro Football Reference which attempts to gauge a player's value per season.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots11}
ggplot(aes(x = AV / seasons_played, y = injured_pct),
       data=stats) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  xlab("Approximate Value per Season") +
  ylab("Injured Percentage") +
  ylim(0, 1)

cor(stats$AV / stats$seasons_played, stats$injured_pct)
```

Clearly a definite correlation here (-0.31)--as injured percentage goes up, a player's value goes down. This is to be expected, as the less time a player is on the field, the less value he can bring his team. This is interesting though because it quantifies how much injury affects a player's value.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots12}
ggplot(aes(x = Draft_Pick, y = AV / seasons_played),
       data=subset(stats, Draft_Pick = Draft_Pick)) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  xlab("Draft Position") +
  ylab("Average AV per Season")

draft_picks = subset(stats, Draft_Pick == Draft_Pick)

cor(draft_picks$Draft_Pick, (draft_picks$AV / draft_picks$seasons_played))
```

This one is fascinating to me. There's a clear and strong correlation (-0.49) between where a player is selected in the draft, and the value he provides to his team throughout his career.

Now let's try combining our datasets, and see how some of our combine measurements correlate with draft position and performance metrics.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots13}
combine_and_stats <- merge(combine, stats, by=c('Player', 'Pos'))
ggplot(aes(x = fortyyd, y = Draft_Pick),
       data=subset(combine_and_stats, fortyyd > 0)) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  xlab("40-Yard Dash Time") +
  ylab("Draft Position")
```

Very slight correlation here--I'm guessing this is something that would make more sense to group by position, which we'll do in the next section.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots14}
ggplot(aes(x = Pos, y = Draft_Pick),
       data=subset(stats, Draft_Pick == Draft_Pick)) +
  geom_boxplot() +
  xlab("Position") +
  ylab("Draft Position") +
  scale_y_continuous(breaks=seq(0, 250, 25))
```

Here's another interesting look, showing draft position by player position. From this, we can see that quarterbacks are drafted highest (lower number), followed by offensive tackles, then defensive ends, defensive tackles, and wide receivers. Punters and nose tackles are the lowest drafted, and kickers don't even show up on this graph (they usually go undrafted).

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. How did the feature(s) of interest vary with other features in \
the dataset?

Injury rates showed direct correlation with player position, draft position, and approximate value. With player position, it was clear that certain positions, such as kicker and punter, had much lower injury rates than others, and there appeared to be significant variation in injury rates even among the other positions. With player age, a relationship with injury rates did not start to present itself until players reached about 31 years of age or older, but then tapered off again after age 37 or so. I do think there is possiblity of finding better correlations with injury rates in multivariate analysis, which we'll do in the next section.

### Did you observe any interesting relationships between the other features \
(not the main feature(s) of interest)?

I thought the relationship between player position and injured percentage, body density, and forty-yard dash times was fascinating. There were clear groupings among positions and even position types (i.e. offensive linemen vs. defensive backs). I'm particulary interested in seeing what we can see with positions in multivariate analysis. The relationships between player position and draft position were also interested--I'm very interested to see how that looks when combined with different combine measurements. Oh, and the relationship between draft position and approximate value was fascinating to me. I'd like to examine that with some other variables as well, maybe player position.

### What was the strongest relationship you found?

Definitely hand size to arm size, and weight to height. These were both very closely correlated, as you would expect.


# Multivariate Plots Section


```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots1}
ggplot(aes(x = age, y = Total_Injured),
       data = injuries) +
  geom_line(aes(color=position_group), stat='summary', fun.y=mean) +
  geom_line(stat='summary', fun.y=mean, linetype=2)
```

When looking at injured games per season by position grouping, we can see that most of these position groupings more or less follow the mean for all players, until you get to around age 33. At that point, certain position groupings--RB, TE, and WR--make a sizable jump in injured games per season. Let's do the same analysis but zoom in on age a bit.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots2}
ggplot(aes(x = age, y = Total_Injured), data = injuries) +
  geom_line(aes(color=position_group), stat='summary', fun.y=mean) +
  geom_line(stat='summary', fun.y=mean, linetype=2) + 
  xlim(30, 40)
```

Here we can see a little better what's going on--there are some really high injured rates for running backs at age 34, tight ends at age 35, and wide receivers at age 36. This is all to be expected, as most NFL players don't play too long past the age of 30. It's also notable that for linemen and quarterbacks, this same trend is not observed, as their injured rates stay pretty close to the overall mean.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots3}

combine$density.bucket = cut(combine$density,
                                  right = TRUE,
                                  breaks = c(2.4, 3.0, 3.5, 4.0, 4.6))

ggplot(aes(x=injured_pct), data = combine) +
  geom_histogram(aes(color=density.bucket)) +
  facet_wrap( ~ position_group)
```

This is another look at injury rates by position, this time with density thrown in as another variable. It's very easy to see the differences between the lighter and heavier position groupings. From this look, it's hard to see density among position groupings affecting the injured percentage much.

Now let's look at how combine measurements affect when a player is drafted, controlling for player position this time.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots4}

combine_and_stats.dp_by_pg_40 <- combine_and_stats %>%
  filter(fortyyd > 0 & Draft_Pick != 'Undrafted') %>%
  group_by(position_group.y, fortyyd) %>%
  summarize(mean_dp = round(mean(Draft_Pick), 4),
            median_dp = as.integer(median(Draft_Pick)),
            n = n()) %>%
  ungroup() %>%
  arrange(fortyyd)

ggplot(aes(x = fortyyd, y = mean_dp),
       data = combine_and_stats.dp_by_pg_40) +
  geom_smooth(aes(color = position_group.y), se=FALSE) +
  xlab("40-Yard Dash Time") +
  ylab("Average Draft Position") +
  scale_color_discrete(name='Position Group') +
  scale_x_continuous(breaks=seq(4.2, 5.7, 0.1))

```

Here we can see that for most position groupings, as a player's 40-yard dash time increases, his draft position tends to increase as well (meaning he's drafted later). This is especially true for tight ends, defensive backs, linebackers, and running backs. For some of the other positions, it seems to go up and down. For wide receivers, for example, between about 4.35 and 4.6, there's a strong positive correlation between 40-yard times and draft position. below and above those points, however, the correlation appears to be negative. This seems counterintuitive, but my guess is it's because there aren't that many players drafted with 40-times in that range, so it's more subject to statistical variance.

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots5}

combine_and_stats$density <- combine_and_stats$weight / combine_and_stats$height

combine_and_stats.dp_by_pg_density <- combine_and_stats %>%
  filter(Draft_Pick != 'Undrafted' & position_group.y != 'ST') %>%
  group_by(position_group.y, density) %>%
  summarize(mean_dp = round(mean(Draft_Pick), 4),
            median_dp = as.integer(median(Draft_Pick)),
            n = n()) %>%
  ungroup() %>%
  arrange(density)

ggplot(aes(x = density, y = mean_dp),
       data = combine_and_stats.dp_by_pg_density) +
  geom_smooth(aes(color = position_group.y), method='lm') +
  xlab("Density") +
  ylab("Average Draft Position") +
  scale_color_discrete(name='Position Group')

```

Density is interesting when looked at by position, because it would seem that higher density is good for certain position groups and bad for others. For running backs, for example, the denser players tend to be drafted earlier. For offensive linemen, on the other hand, denser players tend to be drafted later.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the \
investigation. Were there features that strengthened each other in terms of \
looking at your feature(s) of interest?

Looking at the relationship between player age and injuries, it was interesting that for certain position groups (RB, WR, TE), there was a significant jump in injury rates as players reached their low- to mid-30's.

### Were there any interesting or surprising interactions between features?

The relationship between draft position and 40-yard dash times broken down by player position was fascinating to me. It was clear that for certain positions, there was a positive correlation between 40-yard dash time and draft position, at least within certain ranges.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_One}
ggplot(aes(x = AV / seasons_played, y = injured_pct),
       data=subset(stats, AV > 0)) +
  geom_jitter(alpha=0.2) +
  geom_line(stat = 'summary', fun.y = mean, aes(color='Mean')) +
  geom_smooth(method='lm', aes(color='Regression')) +
  xlab("Approximate Value per Season") +
  ylab("Injured Percentage") +
  ylim(0, 1) +
  ggtitle("Correlation of Injured Percentage with Players' Approximate Value") +
  scale_color_discrete(name="Summary Lines")
```

### Description One

This plot compares a player's approximate value, as calculated by Pro Football Reference, with the percentage of games missed due to injury throughout their careers. This is somewhat to be expected, as the less time you're on the field, the less chance you have of providing value to your team. But to me it's a cool look at this relationship, and helps to quantify the effect that injury rates have on a player's value. NFL teams have to consider this all the time when acquiring players. There are some teams that make a habit of drafting injured players, for example, thinking that by selecting the player when he's injured, they can get him at a discounted price, so to speak. At some point, though, they have to consider whether the expected value of the player will be worth the time missed due to injury, and a plot like this is a first step in looking at that relationship.


### Plot Two
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Two}
ggplot(aes(x = Pos, y = injured_pct),
       data=subset(combine)) +
  geom_boxplot(alpha=0.2) + 
  xlab("Player Position") +
  ylab("Career Injured Percentage") +
  ggtitle("Career Injured Percentage by Player Position")
```

### Description Two

This one I thought was really cool because it shows how injury rates differ by player position. There clearly are significant differences between the positions, which makes some sense, as some positions are more violent than others. This is another factor NFL teams have to consider when acquiring players. Perhaps more importantly, as an avid fantasy football fan, I need to consider this when drafting my team. Sure, running backs tend to score more points in fantasy football than wide receivers, but their injury rates are so much higher that you have a bigger boom-or-bust factor. This was something I always thought was true, but I'd never seen a real statistical comparison until now.

### Plot Three
```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three}
ggplot(aes(x = fortyyd, y = mean_dp),
       data = combine_and_stats.dp_by_pg_40) +
  geom_smooth(aes(color = position_group.y), se=FALSE) +
  xlab("40-Yard Dash Time (Seconds)") +
  ylab("Average Draft Position") +
  scale_color_discrete(name='Position Group') +
  scale_x_continuous(breaks=seq(4.2, 5.7, 0.1)) +
  ggtitle("Average Draft Position by 40-Yd Dash Time, per Position Group")
```

### Description Three

I thought this was a cool look at how a major athleticism test--the 40-yard dash--affects where players are drafted in the NFL. There are clear positive correlations, at least within certain ranges, between the run times and the players' draft position. The correlation is also stronger for certain positions, such as defensive back, than for others, such as defensive line.

# Reflection

I went into this analysis really excited to look at injury rates compared to combine statistics, and was a little disappointed that there were no clear correlations to be found in that area. In retrospect, this shouldn't have been all that surprising, as there's so much randomness to injuries, and it's really hard to find strong correlation, especially when I don't have information about the types of injuries each player had. I do think with more data (injury types, player weight over career, etc.), it would be possible to find stronger correlations. Also, this was a bit outside the scope of this project, but I think it would be cool to look at advanced statistics (rushing yards after contact, receiving yards per route run, etc.) and how they correlated with player value and draft position. Another cool angle would be to look at advanced athletic performance measurments (i.e. SPARQ), and see how that influenced draft position and injury rates.